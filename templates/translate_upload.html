<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Image - Kartini AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="fade-in">

    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">Kartini AI</a>
            <ul class="nav-links">
                <li><a href="/">Beranda</a></li>
                <li class="dropdown">
                    <a href="#" class="active">Fitur Translate</a>
                    <div class="dropdown-menu">
                        <a href="/realtime">Kamera Real-Time</a>
                        <a href="/upload">Unggah Gambar</a>
                    </div>
                </li>
                <li><a href="/tutorial">Tutorial</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <div class="app-container">
            <div class="main-view" id="dropZone" style="background: #FFF5F7;">
                <div class="upload-area" id="uploadArea" style="border-color: var(--primary-light);">
                    <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“¸</div>
                    <h3>Klik di Sini</h3>
                    <p style="color: var(--text-muted);">Pilih gambar isyarat yang ingin Anda terjemahkan</p>
                    <input type="file" id="fileInput" accept="image/*">
                </div>
                <img id="imagePreview" src="#" alt="Preview"
                    style="display: none; width: 100%; height: 100%; object-fit: contain;">
                <div id="loader" class="spinner" style="display: none; position: absolute;"></div>
            </div>

            <div class="side-panel">
                <div class="panel-card">
                    <h3>Hasil Analisis Image</h3>
                    <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 20px;">Hasil deteksi
                        berdasarkan model citra kami.</p>

                    <div id="resultContent" style="display: none;">
                        <div class="status-badge" style="background: var(--accent); color: white;">Terdeteksi âœ¨</div>
                        <div class="result-placeholder" id="labelResult" style="font-size: 4rem;">-</div>
                        <p style="text-align: center; color: var(--text-muted); font-size: 1rem;">
                            Tingkat Akurasi: <span id="confidenceResult"
                                style="font-weight: 700; color: var(--primary);">0</span>%
                        </p>
                    </div>

                    <div id="idleContent" style="text-align: center; padding: 20px 0;">
                        <p style="color: var(--text-muted);">Silakan upload gambar untuk melihat hasilnya.</p>
                    </div>
                </div>

                <div class="panel-card">
                    <h3 style="margin-bottom: 15px;">Tips Gambar Bagus</h3>
                    <div class="instruction-list">
                        <div class="instruction-item">
                            <div class="instruction-icon">ğŸ–ï¸</div>
                            <span>Pastikan tangan terlihat utuh.</span>
                        </div>
                        <div class="instruction-item">
                            <div class="instruction-icon">ğŸ¨</div>
                            <span>Gunakan latar belakang bersih.</span>
                        </div>
                        <div class="instruction-item">
                            <div class="instruction-icon">â€¼ï¸</div>
                            <span>Pastikan gambar hanya berisi tangan.</span>
                        </div>
                    </div>
                </div>

                <button class="glow-btn" id="analyzeBtn" style="width: 100%;" disabled>Analisis Gambar</button>
                <button class="glow-btn" id="resetBtn"
                    style="width: 100%; background: #fff; color: var(--primary); border: 2px solid var(--primary); display: none;">Ganti
                    Gambar</button>
            </div>
        </div>
    </main>

    <div class="container">
        <div class="guide-container">
            <h3>Petunjuk Simbol BISINDO (A-Z)</h3>
            <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 0.9rem;">
                Dekatkan kursor pada huruf untuk melihat contoh gambar, atau klik untuk detail lebih besar.
            </p>
            <div class="letter-grid" id="alphabetGrid">
                <!-- Buttons will be generated here -->
            </div>
        </div>
    </div>

    <!-- Modal for Detail -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <button class="modal-close" id="closeModal">&times;</button>
            <h2 id="modalTitle" style="margin-bottom: 15px; color: var(--primary);">Huruf A</h2>
            <img id="modalImage" src="" alt="Detail BISINDO">
            <p style="color: var(--text-muted);">Contoh peragaan isyarat untuk huruf ini dalam sistem BISINDO.</p>
        </div>
    </div>

    <footer class="container">
        <div class="footer-content">
            <p>Â© 2026 Grup Kartini. Didesain dengan penuh CINTA untuk inklusivitas.</p>
        </div>
    </footer>

    <script>
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const imagePreview = document.getElementById('imagePreview');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const resetBtn = document.getElementById('resetBtn');
        const loader = document.getElementById('loader');
        const resultContent = document.getElementById('resultContent');
        const idleContent = document.getElementById('idleContent');
        const labelResult = document.getElementById('labelResult');
        const confidenceResult = document.getElementById('confidenceResult');

        const alphabetGrid = document.getElementById('alphabetGrid');
        const modalOverlay = document.getElementById('modalOverlay');
        const modalTitle = document.getElementById('modalTitle');
        const modalImage = document.getElementById('modalImage');
        const closeModal = document.getElementById('closeModal');

        uploadArea.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    uploadArea.style.display = 'none';
                    analyzeBtn.disabled = false;
                }
                reader.readAsDataURL(file);
            }
        });

        analyzeBtn.addEventListener('click', async () => {
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);

            analyzeBtn.style.display = 'none';
            loader.style.display = 'block';
            idleContent.style.display = 'none';

            try {
                const response = await fetch('/predict-upload', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    labelResult.innerText = data.label;
                    confidenceResult.innerText = data.confidence;
                    resultContent.style.display = 'block';
                    resetBtn.style.display = 'block';
                }
            } catch (error) {
                alert('Terjadi kesalahan koneksi.');
            } finally {
                loader.style.display = 'none';
            }
        });

        resetBtn.addEventListener('click', () => {
            fileInput.value = '';
            imagePreview.style.display = 'none';
            uploadArea.style.display = 'block';
            analyzeBtn.style.display = 'block';
            analyzeBtn.disabled = true;
            resetBtn.style.display = 'none';
            resultContent.style.display = 'none';
            idleContent.style.display = 'block';
        });

        async function loadAlphabet() {
            try {
                const response = await fetch('/bisindo-list');
                const mapping = await response.json();

                alphabetGrid.innerHTML = '';
                Object.keys(mapping).forEach(letter => {
                    const btn = document.createElement('button');
                    btn.className = 'letter-btn';
                    btn.innerText = letter;

                    // Hover Preview
                    const preview = document.createElement('div');
                    preview.className = 'hover-preview';
                    const img = document.createElement('img');
                    img.src = `/bisindo-image/${letter}/${mapping[letter]}`;
                    preview.appendChild(img);
                    btn.appendChild(preview);

                    // Click Detail
                    btn.addEventListener('click', () => {
                        modalTitle.innerText = `Huruf ${letter}`;
                        modalImage.src = `/bisindo-image/${letter}/${mapping[letter]}`;
                        modalOverlay.style.display = 'flex';
                    });

                    alphabetGrid.appendChild(btn);
                });
            } catch (error) {
                console.error("Gagal mengambil daftar alfabet:", error);
            }
        }

        closeModal.addEventListener('click', () => {
            modalOverlay.style.display = 'none';
        });

        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                modalOverlay.style.display = 'none';
            }
        });

        // Initialize
        loadAlphabet();
    </script>
</body>

</html>