<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Detection - Kartini AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="fade-in">

    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">Kartini AI</a>
            <ul class="nav-links">
                <li><a href="/">Beranda</a></li>
                <li class="dropdown">
                    <a href="#" class="active">Fitur Translate</a>
                    <div class="dropdown-menu">
                        <a href="/realtime">Kamera Real-Time</a>
                        <a href="/upload">Unggah Gambar</a>
                    </div>
                </li>
                <li><a href="/tutorial">Tutorial</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <div class="app-container">
            <div class="main-view">
                <img id="videoFeed" src="{{ url_for('video_feed') }}" alt="Real-time Stream">
            </div>

            <div class="side-panel">
                <div class="panel-card">
                    <div class="status-badge" id="statusBadge">
                        <span
                            style="display:inline-block; width:10px; height:10px; background:#2E7D32; border-radius:50%; margin-right:5px;"></span>
                        Kamera Aktif
                    </div>
                    <h3 style="margin-bottom: 10px;">Hasil Terjemahan</h3>
                    <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 15px;">Huruf terdeteksi secara
                        otomatis oleh sistem</p>

                    <div class="result-placeholder" id="predictionResult">
                        ...
                    </div>
                </div>

                <div class="panel-card">
                    <h3 style="margin-bottom: 15px;">Petunjuk Penggunaan</h3>
                    <div class="instruction-list">
                        <div class="instruction-item">
                            <div class="instruction-icon">ðŸ’¡</div>
                            <span>Posisikan tangan dengan jelas di depan kamera.</span>
                        </div>
                        <div class="instruction-item">
                            <div class="instruction-icon">ðŸ•’</div>
                            <span>Tahan posisi tangan selama 1-2 detik untuk stabilitas.</span>
                        </div>
                        <div class="instruction-item">
                            <div class="instruction-icon">âœ¨</div>
                            <span>Pastikan cahaya ruangan terang dan latar belakang bersih.</span>
                        </div>
                    </div>
                </div>

                <a href="/" class="glow-btn" style="text-align: center; width: 100%;">Kembali</a>
            </div>
        </div>
    </main>

    <div class="container">
        <div class="guide-container">
            <h3> Petunjuk Simbol BISINDO (A-Z)</h3>
            <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 0.9rem;">
                Dekatkan kursor pada huruf untuk melihat contoh gambar, atau klik untuk detail lebih besar.
            </p>
            <div class="letter-grid" id="alphabetGrid">
                <!-- Buttons will be generated here -->
            </div>
        </div>
    </div>

    <!-- Modal for Detail -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <button class="modal-close" id="closeModal">&times;</button>
            <h2 id="modalTitle" style="margin-bottom: 15px; color: var(--primary);">Huruf A</h2>
            <img id="modalImage" src="" alt="Detail BISINDO">
            <p style="color: var(--text-muted);">Contoh peragaan isyarat untuk huruf ini dalam sistem BISINDO.</p>
        </div>
    </div>

    <footer class="container">
        <div class="footer-content">
            <p>Â© 2026 Grup Kartini. Didesain dengan penuh CINTA untuk inklusivitas.</p>
        </div>
    </footer>

    <script>
        const predictionDiv = document.getElementById('predictionResult');
        const alphabetGrid = document.getElementById('alphabetGrid');
        const modalOverlay = document.getElementById('modalOverlay');
        const modalTitle = document.getElementById('modalTitle');
        const modalImage = document.getElementById('modalImage');
        const closeModal = document.getElementById('closeModal');

        async function fetchPrediction() {
            try {
                const response = await fetch('/get-realtime-prediction');
                const data = await response.json();
                if (data.label) {
                    predictionDiv.innerText = data.label;
                }
            } catch (error) {
                console.error("Gagal mengambil prediksi:", error);
            }
        }

        async function loadAlphabet() {
            try {
                const response = await fetch('/bisindo-list');
                const mapping = await response.json();

                alphabetGrid.innerHTML = '';
                Object.keys(mapping).forEach(letter => {
                    const btn = document.createElement('button');
                    btn.className = 'letter-btn';
                    btn.innerText = letter;

                    // Hover Preview
                    const preview = document.createElement('div');
                    preview.className = 'hover-preview';
                    const img = document.createElement('img');
                    img.src = `/bisindo-image/${letter}/${mapping[letter]}`;
                    preview.appendChild(img);
                    btn.appendChild(preview);

                    // Click Detail
                    btn.addEventListener('click', () => {
                        modalTitle.innerText = `Huruf ${letter}`;
                        modalImage.src = `/bisindo-image/${letter}/${mapping[letter]}`;
                        modalOverlay.style.display = 'flex';
                    });

                    alphabetGrid.appendChild(btn);
                });
            } catch (error) {
                console.error("Gagal mengambil daftar alfabet:", error);
            }
        }

        closeModal.addEventListener('click', () => {
            modalOverlay.style.display = 'none';
        });

        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                modalOverlay.style.display = 'none';
            }
        });

        // Initialize
        loadAlphabet();
        setInterval(fetchPrediction, 200);
    </script>
</body>

</html>